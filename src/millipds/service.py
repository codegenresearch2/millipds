from typing import Optional, Set, Tuple\nimport importlib.metadata\nimport logging\nimport asyncio\nimport time\nimport os\nimport io\nimport json\nimport uuid\nimport hashlib\n\nimport apsw\nimport aiohttp\nfrom aiohttp_middlewares import cors_middleware\nfrom aiohttp import web\nimport jwt\n\nimport cbrrr\n\nfrom . import static_config\nfrom . import database\nfrom . import auth_oauth\nfrom . import atproto_sync\nfrom . import atproto_repo\nfrom . import crypto\nfrom . import util\nfrom .appview_proxy import service_proxy\nfrom .auth_bearer import authenticated\nfrom .app_util import *\nfrom .did import DIDResolver\n\nlogger = logging.getLogger(__name__)\n\nroutes = web.RouteTableDef()\n\nasync def atproto_service_proxy_middleware(request: web.Request, handler):\n    # https://atproto.com/specs/xrpc#service-proxying\n    atproto_proxy = request.headers.get(\